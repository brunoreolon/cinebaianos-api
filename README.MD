# üé¨ Cinebaianos API

![Java](https://img.shields.io/badge/Java-21-blue)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.6-green)
![Flyway](https://img.shields.io/badge/Flyway-8.6-blue)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-blue)
![Maven](https://img.shields.io/badge/Maven-3.9.4-red)

A **Cinebaianos API** √© uma aplica√ß√£o backend constru√≠da em **Java com Spring Boot**, respons√°vel por gerenciar informa√ß√µes de filmes, votos de usu√°rios e autentica√ß√£o via JWT.
A API se integra com o servi√ßo externo **TMDb (The Movie Database)** para fornecer informa√ß√µes detalhadas sobre filmes.

---

## üõ† Tecnologias utilizadas

* **Java 21** ‚Äì Linguagem de programa√ß√£o principal.
* **Spring Boot 3** ‚Äì Framework para cria√ß√£o de APIs REST.
* **Spring Security + JWT** ‚Äì Autentica√ß√£o e autoriza√ß√£o.
* **Spring Data JPA + Hibernate** ‚Äì Persist√™ncia de dados com PostgreSQL.
* **Flyway** ‚Äì Gerenciamento de versionamento de banco de dados.
* **PostgreSQL** ‚Äì Banco de dados relacional.
* **TMDb API** ‚Äì API externa para buscar informa√ß√µes de filmes.
* **Maven** ‚Äì Gerenciamento de depend√™ncias e build.
* **Docker** ‚Äì Containeriza√ß√£o da aplica√ß√£o.

---

## üåê Funcionalidades principais

* Cadastro e autentica√ß√£o de usu√°rios.
* Adicionar filmes pelo ID TMDb ou pelo t√≠tulo/ano.
* Listar filmes e detalhes de cada filme.
* Registrar votos de usu√°rios.
* Gerar rankings de filmes com base nos votos.
* Consulta a filmes via **TMDb API**.
* Configura√ß√£o de JWT para autentica√ß√£o segura.
* Suporte a perfis de ambiente (`dev` e `prod`) com vari√°veis externas.

---

## üéØ Principais endpoints da API

### 1Ô∏è‚É£ Adicionar um filme pelo ID

* **POST** `/api/movies`
* **Descri√ß√£o:** Adiciona um filme pelo ID do TMDb escolhido pelo usu√°rio.
* **Body:**

```json
{
  "movie": {
    "id": 120
  },
  "chooser": {
    "discordId": "000000000000000001"
  }
}
```

üí° Obs: O campo `vote` √© opcional.

---

### 2Ô∏è‚É£ Buscar e adicionar filmes por t√≠tulo e ano

* **POST** `/api/movies/candidates`
* **Descri√ß√£o:** Consulta filmes pelo t√≠tulo e ano. Salva o filme se encontrado ou retorna erro se houver m√∫ltiplas correspond√™ncias.
* **Body:**

```json
{
  "title": "O Senhor dos An√©is",
  "year": 2003,
  "chooser": {
    "discordId": "000000000000000001"
  },
  "vote": {
    "id": 1
  }
}
```

üí° Obs: O campo `vote` √© opcional.

---

### 3Ô∏è‚É£ Votar em um filme

* **POST** `/api/votes`
* **Descri√ß√£o:** Permite que um usu√°rio registre um voto para um filme.
* **Body:**

```json
{
  "voter": {
    "discordId": "000000000000000001"
  },
  "movie": {
    "id": 48
  },
  "vote": 1
}
```

---

### 4Ô∏è‚É£ Listar votos de um filme

* **GET** `/api/votes/{movieId}/votes`
* **Descri√ß√£o:** Retorna todos os votos que um filme espec√≠fico recebeu.
* **Exemplo de resposta:**

```json
{
  "movie": {
    "id": 48,
    "title": "O Senhor dos An√©is: A Sociedade do Anel",
    "genre": "Aventura",
    "year": "2001",
    "tmdbId": "120",
    "dateAdded": "2025-11-02T01:43:59.6786",
    "posterPath": "https://image.tmdb.org/t/p/original/p9tiZkjs5A1XdD3m3E15ij9IxCV.jpg",
    "chooser": {
      "discordId": "000000000000000001",
      "name": "Bruno Reolon1"
    }
  },
  "votes": [
    {
      "voter": {
        "discordId": "000000000000000001",
        "name": "Bruno Reolon"
      },
      "vote": {
        "id": 1,
        "description": "Da Hora"
      }
    },
    {
      "voter": {
        "discordId": "000000000000000002",
        "name": "A ü·¥ç…™ Ä"
      },
      "vote": {
        "id": 1,
        "description": "Da Hora"
      }
    }
  ]
}
```
---

## üì¶ Docker

### 1Ô∏è‚É£ Criar a imagem Docker

```bash
docker build -t cinebaianos-api -f docker/Dockerfile .
```

### 2Ô∏è‚É£ Rodar o container

```bash
docker run -d --name cinebaianos-api -p 8080:8080 cinebaianos-api
```

---

## üîß Vari√°veis de ambiente

```bash
# =======================
# Banco de dados
# =======================
DB_URL=jdbc:postgresql://localhost:5432/cinebaianosdb
DB_USER=postgres
DB_PASSWORD=

# =======================
# TMDb API
# =======================
BASE_URL=https://api.themoviedb.org/3
API_KEY=
POSTER_PATH=https://image.tmdb.org/t/p/original

# =======================
# E-mail
# =======================
MAIL_HOST=
MAIL_PORT=
MAIL_USERNAME=
MAIL_PASSWORD=

# =======================
# JWT
# =======================
JWT_KEYSTORE_PATH=jwt.jks
JWT_KEYSTORE_PASSWORD=
JWT_KEY_PASSWORD=
JWT_ALIAS=jwt
```